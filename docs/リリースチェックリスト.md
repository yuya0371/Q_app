# リリースチェックリスト — Q.（仮）

本ドキュメントは、App Store / Google Play への申請前に確認すべき全項目をまとめたものです。

---

## 1. 機能テスト

### 1.1 認証機能
- [ ] メール + パスワードでサインアップできる
- [ ] メール確認コードが届き、確認が完了する
- [ ] 確認コードの再送信が動作する
- [ ] ログイン / ログアウトが正常に動作する
- [ ] パスワードリセット（コード送信 → 新パスワード設定）が動作する
- [ ] メールアドレス変更（新メールへの確認コード送信）が動作する
- [ ] 13歳未満の生年月日で登録が拒否される
- [ ] メールアドレスが小文字に正規化される（大文字で入力しても同一扱い）
- [ ] 複数デバイスでの同時ログインが可能

### 1.2 オンボーディング / プロフィール
- [ ] 初回ログイン後にアプリ内ID作成画面が表示される
- [ ] アプリ内IDバリデーション: 3~15文字、英小文字+数字+_のみ、先頭英字、予約語(admin/support)不可
- [ ] 表示名: 1~20文字、絵文字不可、許可文字種のみ受付
- [ ] 表示名未設定時にアプリ内IDが表示される
- [ ] プロフィール画像アップロード（JPEG/PNG、5MB以下）が動作する
- [ ] プロフィール画像未設定時にランダム生成アイコンが表示される
- [ ] プロフィール編集（表示名変更、画像変更）が動作する

### 1.3 今日の質問
- [ ] 毎日10:00~21:00の間に今日の質問が公開される
- [ ] 未回答時に他人の回答が見えない（回答後に解放される）
- [ ] On-time判定: 公開から30分以内の回答が On-time と表示される
- [ ] Late表示: 30分以降の回答に経過時間が表示される（丸め表示含む）
- [ ] フォールバック: 当日の質問が無い場合でも予備お題が表示される
- [ ] 予備お題発動時にユーザーにはそのことが見えない

### 1.4 回答（投稿）
- [ ] テキスト投稿（最大80文字、改行OK）が動作する
- [ ] URL含有投稿（http/https）が拒否される
- [ ] 回答の削除が動作し、未回答扱いになる
- [ ] 削除後の再投稿が不可であること
- [ ] 削除済み回答の復活が動作する
- [ ] 自分の過去回答履歴が閲覧できる
- [ ] 削除済み回答が「削除済み」ラベル付きで履歴に表示される
- [ ] 他人の過去回答は閲覧できない（今日の回答のみ表示）

### 1.5 タイムライン
- [ ] フォロー中の人の今日の回答のみ表示される
- [ ] 「全体」タイムラインが存在しないこと
- [ ] 並び順: On-time優先 → 投稿が早い順
- [ ] 自分の投稿も並び順ルールに従う（先頭固定されない）
- [ ] 閲覧範囲設定（相互フォローのみ / フォロワーまで）が正しく反映される

### 1.6 リアクション
- [ ] 固定5種類（&#10084;&#65039; &#128293; &#128514; &#129300; &#128064;）のリアクションが付与できる
- [ ] 1人1投稿につき最大1つのリアクション
- [ ] リアクションの変更・解除が動作する
- [ ] リアクション数（カウント）が表示されないこと

### 1.7 フォロー
- [ ] ユーザーのフォロー / フォロー解除が動作する
- [ ] 自分のフォロー一覧・フォロワー一覧が閲覧できる
- [ ] 他人のフォロー数・フォロワー数（数値のみ）が表示される
- [ ] 他人のフォロー一覧は閲覧できないこと

### 1.8 ユーザー検索
- [ ] アプリ内ID完全一致検索が動作する
- [ ] 検索結果にID + 表示名 + アイコンが表示される

### 1.9 ブロック
- [ ] ユーザーのブロック / ブロック解除が動作する
- [ ] ブロック時に双方のフォロー/フォロワー関係が自動解除される
- [ ] ブロック相手が検索結果・タイムラインに表示されない
- [ ] ブロック一覧が閲覧できる

### 1.10 通報
- [ ] ユーザー通報（カテゴリ + 自由記述）が送信できる
- [ ] 投稿通報（カテゴリ + 自由記述）が送信できる
- [ ] 通報カテゴリ6種（スパム / 嫌がらせ・いじめ / 不適切なコンテンツ / なりすまし / 個人情報の公開 / その他）が選択可能

### 1.11 ユーザーお題提出
- [ ] 今日の回答を投稿した後に「お題を提案する」ボタンが表示される
- [ ] お題提出（最大80文字、改行OK、URL禁止）が動作する
- [ ] 1日1件までの制限が正しく動作する
- [ ] 送信成功時に固定文言（「受け付けました」等）が表示される

### 1.12 通知
- [ ] 今日の質問公開時にプッシュ通知が届く
- [ ] 通知許可リクエストが文脈付きで表示される
- [ ] 通知がOFFの場合、OS設定への誘導が表示される

### 1.13 共有・ディープリンク
- [ ] プロフィールへのリンク共有が動作する
- [ ] QRコード生成が動作する
- [ ] ディープリンク: インストール済み → アプリ内の該当画面を開く
- [ ] ディープリンク: 未インストール → App Store / Google Play へ誘導

### 1.14 アカウント削除（退会）
- [ ] アプリ内からアカウント削除を開始できる
- [ ] 確認ダイアログ（「復元できません」等）が表示される
- [ ] 削除開始後に即ログアウトし、「削除を開始しました」が表示される
- [ ] Step Functions で段階削除が実行される
  - [ ] 全デバイスサインアウト（AdminUserGlobalSignOut）
  - [ ] アプリ内データ削除（DynamoDB）
  - [ ] Cognitoユーザー削除（AdminDeleteUser）
- [ ] 退会後、相手側の画面から完全に消える

### 1.15 強制アップデート
- [ ] アプリバージョンが最低バージョンを下回った場合にアプリ使用不可になる
- [ ] GET /app/version エンドポイントが正しく動作する

### 1.16 その他
- [ ] ダークモード対応（OS設定に連動）
- [ ] オフライン時にキャッシュした過去データが閲覧可能
- [ ] オフライン時に投稿・リアクション等がオンライン必須であることが明示される

---

## 2. 管理画面テスト

- [ ] 管理者認証（IAM + Cognito Identity）でログインできる
- [ ] お題管理: 運営お題の追加・編集が動作する
- [ ] お題管理: ユーザーお題の承認・却下が動作する
- [ ] 通報管理: 通報一覧の確認・対応ステータス更新が動作する
- [ ] ユーザー管理: ユーザー検索・詳細確認が動作する
- [ ] ユーザー管理: BAN（アカウント停止）/ BAN解除が動作する
- [ ] BAN時にログイン不可（既存セッションも強制ログアウト）になる
- [ ] NGワード管理: NGワードの追加・削除が動作する
- [ ] flagged投稿一覧が表示される
- [ ] 監査ログ一覧が表示される

---

## 3. セキュリティ確認

### 3.1 認証・認可
- [ ] 全API（公開エンドポイント除く）でCognito JWT認証が必須
- [ ] 他人のデータへの不正アクセスが防止されている
- [ ] 管理者APIが一般ユーザーからアクセス不可
- [ ] パスワードポリシー: 最小8文字が適用されている
- [ ] アクセストークン有効期限: 1時間
- [ ] リフレッシュトークン有効期限: 30日

### 3.2 入力バリデーション
- [ ] 投稿本文: 80文字制限 + URL禁止がバックエンドで検証される
- [ ] アプリ内ID: バリデーションルールがバックエンドで検証される
- [ ] 表示名: バリデーションルールがバックエンドで検証される
- [ ] お題提出: 80文字制限 + URL禁止がバックエンドで検証される
- [ ] プロフィール画像: 5MB制限・形式チェックがバックエンドで検証される

### 3.3 NGワード・コンテンツフィルタ
- [ ] NGワード検知投稿が flagged フラグ付きで保存される
- [ ] NGワードが表示時に * でマスクされる（投稿は弾かない）
- [ ] NGワード検知投稿が管理画面のflagged投稿一覧に表示される

### 3.4 データ保護
- [ ] DynamoDB全テーブルで Point-in-Time Recovery が有効（確認済み: database-stack.ts で設定）
- [ ] DynamoDB全テーブルの removalPolicy が RETAIN（確認済み）
- [ ] S3バケットのアクセス制御が適切
- [ ] CloudWatchログに機密情報が出力されていない

---

## 4. UGC審査要件対応（App Store / Google Play 共通）

App StoreのUGC（User Generated Content）要件を満たすために、以下の機能が全て動作することを確認する。

- [ ] **ブロック機能**: ユーザーをブロックし、コンテンツを完全遮断できる
- [ ] **通報機能**: 不適切なユーザー・投稿を通報できる（カテゴリ + 自由記述）
- [ ] **コンテンツフィルタ**: NGワードフィルタが動作している
- [ ] **運営対応体制**: 通報を24時間以内に確認・対応する方針が明文化されている
- [ ] **管理画面**: 通報対応・BAN・NGワード管理が運営可能な状態

---

## 5. 法務ドキュメント

- [ ] **利用規約**が作成され、アプリ内からアクセスできる
  - [ ] 禁止行為が記載されている
  - [ ] 免責事項が記載されている
  - [ ] UGCに関する規定が記載されている
  - [ ] アカウント削除に関する規定が記載されている
- [ ] **プライバシーポリシー**が作成され、アプリ内からアクセスできる
  - [ ] 収集するデータの種類が記載されている
  - [ ] データの利用目的が記載されている
  - [ ] データの第三者提供について記載されている
  - [ ] データの保管・削除について記載されている
- [ ] 利用規約・プライバシーポリシーのURLがApp Store Connect / Google Play Consoleに設定されている

---

## 6. App Store 申請要件（iOS）

### 6.1 基本要件
- [ ] Apple Developer Programへの登録が完了している
- [ ] App Store Connectでアプリが作成されている
- [ ] Bundle Identifier: `com.q.app` が正しく設定されている

### 6.2 年齢制限
- [ ] 13歳以上の年齢制限が設定されている（登録時の生年月日チェック）
- [ ] App Store Connectの年齢レーティングが適切に設定されている

### 6.3 アカウント削除導線（Apple要件）
- [ ] アプリ内からアカウント削除を開始できる導線がある
- [ ] 削除が完了まで進む（物理削除）
- [ ] 削除フローのスクリーンショットをレビュー用に準備

### 6.4 UGC要件
- [ ] ブロック・通報・フィルタ機能が実装済み
- [ ] レビュー時にUGC対応を説明するノートを準備

### 6.5 プッシュ通知
- [ ] APNs（Apple Push Notification service）の設定が完了している
- [ ] Expo Push Notifications との連携が動作する

### 6.6 ストア掲載情報
- [ ] アプリアイコン（1024x1024）が準備されている
- [ ] スクリーンショット（6.7インチ / 6.5インチ / 5.5インチ等）が準備されている
- [ ] アプリの説明文（日本語）が作成されている
- [ ] キーワードが設定されている
- [ ] カテゴリ（ソーシャルネットワーキング）が選択されている
- [ ] サポートURL / プライバシーポリシーURLが設定されている

### 6.7 その他
- [ ] TestFlightでの社内テストが完了している
- [ ] レビュー用デモアカウント（メール + パスワード）を準備

---

## 7. Google Play 申請要件（Android）— 後日対応

> **注意**: MVPはiOS先行リリース。AndroidリリースはWeb退会導線の実装後に行う。

### 7.1 Web退会導線（Android必須）
- [ ] Web退会ページが作成されている
- [ ] アプリ内導線 + Webリンクの両方が用意されている

### 7.2 基本要件
- [ ] Google Play Developer Consoleへの登録が完了している
- [ ] Package Name: `com.q.app` が正しく設定されている
- [ ] データセーフティフォームが入力されている
- [ ] 年齢レーティング（IARC）が設定されている

### 7.3 ストア掲載情報
- [ ] アプリアイコンが準備されている
- [ ] フィーチャーグラフィック（1024x500）が準備されている
- [ ] スクリーンショットが準備されている
- [ ] アプリの説明文（日本語）が作成されている

---

## 8. インフラ確認

### 8.1 本番環境デプロイ
- [ ] CDKの `env` コンテキストが `prod` に設定されている
- [ ] 本番環境用のスタックがデプロイされている
  - [ ] `prod-q-auth`（Cognito）
  - [ ] `prod-q-database`（DynamoDB）
  - [ ] `prod-q-storage`（S3）
  - [ ] `prod-q-workflow`（Step Functions）
  - [ ] `prod-q-api`（API Gateway + Lambda）
  - [ ] `prod-q-scheduler`（EventBridge + Lambda）
- [ ] 本番環境のAPIエンドポイントURLを確認
- [ ] 本番環境のCognito User Pool ID / Client IDを確認
- [ ] 本番環境の環境変数がアプリに正しく設定されている

### 8.2 DynamoDB
- [ ] 全12テーブルが作成されている（Users, DailyQuestions, Questions, Answers, Follows, Blocks, Reactions, Reports, UserQuestionSubmissions, NGWords, PushTokens, AdminLogs）
- [ ] 全テーブルで Point-in-Time Recovery が有効
- [ ] 全テーブルの removalPolicy が RETAIN
- [ ] GSIが正しく作成されている
- [ ] AdminLogsテーブルのTTL（90日）が設定されている

### 8.3 監視・アラート
- [ ] CloudWatch Logsが全Lambda関数で有効
- [ ] Sentryが設定されている（アプリ + Lambda）
- [ ] Sentryのアラート通知先が設定されている
- [ ] Lambda関数のエラー率監視が設定されている
- [ ] API Gatewayの4xx/5xxエラー監視が設定されている

### 8.4 定期処理
- [ ] EventBridge: 毎日0:00 JST（UTC 15:00）に質問スケジュールLambdaが起動する
- [ ] EventBridge: 10分おき（10:00~21:00 JST）にチェック&公開Lambdaが起動する
- [ ] 定期処理のログが正しく出力される

### 8.5 退会処理（Step Functions）
- [ ] Step Functions のステートマシン `prod-q-delete-user` がデプロイされている
- [ ] 退会処理が正常に完了する（全ステップ成功）
- [ ] 失敗時にredrive（途中から再開）が可能
- [ ] 二重実行防止（`deleteUser-{userId}` の実行名固定）が動作する

---

## 9. 強制アップデート設定

- [ ] 最低バージョン（minimumVersion）が正しく設定されている
- [ ] アプリが最低バージョンを下回った場合にアップデート促進画面が表示される
- [ ] アップデート促進画面からApp Store / Google Playに遷移できる

---

## 10. ディープリンク・ドメイン設定

- [ ] ドメインが取得されている
- [ ] Universal Links（iOS）が設定されている
- [ ] App Links（Android）が設定されている
- [ ] apple-app-site-association ファイルがホスティングされている
- [ ] assetlinks.json ファイルがホスティングされている
- [ ] ディープリンクが正しく動作する（インストール済み / 未インストール）

---

## 11. CI/CD 確認

- [ ] GitHub Actions の CI ワークフロー（ci.yml）が正常に動作する
- [ ] インフラデプロイワークフロー（deploy-infra.yml）が正常に動作する
- [ ] 管理画面デプロイワークフロー（deploy-admin.yml）が正常に動作する
- [ ] EAS Build ワークフロー（eas-build.yml）が正常に動作する
- [ ] EAS Update ワークフロー（eas-update.yml）が正常に動作する
- [ ] 本番環境向けのシークレット / 環境変数がGitHub Secretsに設定されている
- [ ] mainブランチへのマージ時にデプロイが自動実行される（またはその設定が完了）

---

## 12. ストア掲載物の準備

### 12.1 アプリアイコン
- [ ] アプリアイコン（1024x1024 PNG）が作成されている
- [ ] iOS用 / Android用それぞれの形式で準備されている

### 12.2 スクリーンショット
- [ ] iPhone 6.7インチ（iPhone 15 Pro Max等）のスクリーンショットが準備されている
- [ ] iPhone 6.5インチ（iPhone 11 Pro Max等）のスクリーンショットが準備されている
- [ ] 主要画面のスクリーンショットが含まれている（ホーム、タイムライン、プロフィール等）
- [ ] 日本語UIのスクリーンショットであること

### 12.3 説明文
- [ ] アプリ名: 「Q.」
- [ ] サブタイトル / 短い説明文が作成されている
- [ ] 詳細説明文（日本語）が作成されている
- [ ] 「新機能」セクション（v1.0.0のリリースノート）が作成されている

---

## 13. 運営準備

### 13.1 お題
- [ ] 運営お題100問が作成され、DBに投入されている
- [ ] 各お題が80文字以内であること
- [ ] お題にURL・不適切な内容が含まれていないこと

### 13.2 NGワード
- [ ] NGワード初期セットが作成され、DBに投入されている
- [ ] 暴言・差別・個人情報に関する基本的なワードが含まれている

### 13.3 管理者アカウント
- [ ] 管理者アカウントが作成されている（isAdmin: true）
- [ ] 管理画面にログインできることを確認
- [ ] 管理者に最小権限が付与されている（Step Functions redrive/実行確認のみ）
- [ ] 管理者のMFAが有効化されている

### 13.4 運用体制
- [ ] 通報対応の運用フロー（24時間以内対応方針）が確立されている
- [ ] 運用手順書が作成されている
- [ ] 障害対応マニュアルが作成されている
- [ ] 退会処理の失敗時の復旧手順（Step Functions redrive）が文書化されている

---

## 14. リリース直前の最終確認

- [ ] 全テストが通過している（ユニットテスト）
- [ ] 本番環境で主要フローを一通り手動確認
  - [ ] サインアップ → メール確認 → ID作成 → 質問表示 → 回答投稿 → タイムライン表示
  - [ ] フォロー → 相手の回答が見える
  - [ ] リアクション付与 → 変更 → 解除
  - [ ] ブロック → 通報
  - [ ] アカウント削除
- [ ] 本番用ドメインがAPIおよびディープリンクで使用されている
- [ ] devデバッグ用の設定やログが無効化されている
- [ ] Sentryのリリースバージョンが正しく設定されている
- [ ] 強制アップデートの最低バージョンが v1.0.0 に設定されている
- [ ] アプリバージョンが 1.0.0 であること（app.json で確認済み）

---

## 変更履歴

| 日付 | 内容 |
|---|---|
| 2026-02-09 | 初版作成 |
